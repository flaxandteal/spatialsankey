!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("d3"),require("d3-scale")):"function"==typeof define&&define.amd?define(["exports","d3","d3-scale"],r):r(n.d3=n.d3||{},n.d3Base,n.d3)}(this,function(n,r,e){"use strict";function t(){var n,r={},e={},t=[],i=[],a={},u={};return r.lmap=function(e){return arguments.length?(n=e,r):n},r.nodes=function(n){return arguments.length?(e=n,e.features&&(e=e.features),e.forEach(function(n){n.geometry.coordinates.reverse()}),r):e},r.flows=function(n){return arguments.length?(i=n,r):i},r.ranges=function(){return e=e.map(function(n){var r=t.filter(function(r){return r.target==n.id}),e=t.filter(function(r){return r.source==n.id});return n.properties.aggregate_inflows=r.reduce(function(n,r){return n+r.flow},0),n.properties.aggregate_outflows=e.reduce(function(n,r){return n+r.flow},0),n}),u.min=o.min(t,function(n){return n.flow}),u.max=o.max(t,function(n){return n.flow}),a.min=o.min(e,function(n){var r=n.properties.aggregate_outflows;return 0==r?null:r}),a.max=o.max(e,function(n){return n.properties.aggregate_outflows}),{links:u,nodes:a}},r.links=function(n){if(!arguments.length)return t;t=n,t=t.map(function(n){var r=e.filter(function(r){return r.id==n.source})[0],t=e.filter(function(r){return r.id==n.target})[0];if(!r||!t)return null;n.source_coords=r.geometry.coordinates,n.target_coords=t.geometry.coordinates;var o=i.filter(function(r){return r.id==n.id})[0];return o&&(n.flow=o.flow),n.flow=parseFloat(n.flow),n});var o=t.length;return t=t.filter(function(n){return null!=n}),o!=t.length&&console.log("Dropped "+(o-t.length)+" links that could not be matched to a node."),r.ranges(),r},r.link=function(r){var e=.4,t=.1,o={min:1,max:8},i=!1,a=!1;r&&(r.xshift&&(e=r.xshift),r.yshift&&(t=r.yshift),r.minwidth&&(o.min=r.minwidth),r.maxwidth&&(o.max=r.maxwidth),r.use_arcs&&(i=r.use_arcs),r.flip&&(a=r.flip));var f=function(r){var o=n.latLngToLayerPoint(r.source_coords),u=n.latLngToLayerPoint(r.target_coords),f=o.x-u.x,l=o.y-u.y;if(i)if(l<0||a)var s=[e*f,t*l,t*f,e*l];else var s=[t*f,e*l,e*f,t*l];else if(l<0||a)var s=[e*f,t*l,e*f,t*l];else var s=[t*f,e*l,t*f,e*l];return"M"+o.x+","+o.y+"C"+(o.x-s[0])+","+(o.y-s[1])+" "+(u.x+s[2])+","+(u.y+s[3])+" "+u.x+","+u.y},l=function(n){if(0==n.flow&&0!=u.min)return 0;var r=n.flow-u.min,e=u.max-u.min;return(o.max-o.min)*(r/e)+o.min};return f.width=function(n){return arguments.length?l=n:l},f},r.node=function(r){var e={min:10,max:20},t=["yellow","red"];r&&(r.minradius&&(e.min=r.minradius),r.maxradius&&(e.max=r.maxradius),r.mincolor&&(t[0]=r.mincolor),r.maxcolor&&(t[1]=r.maxcolor));var i=o.scale.linear().domain([0,1]).range(t),u={};return u.cx=function(r){var e=n.latLngToLayerPoint(r.geometry.coordinates).x;return e||null},u.cy=function(r){var e=n.latLngToLayerPoint(r.geometry.coordinates).y;return e||null},u.r=function(n){if(0==n.properties.aggregate_outflows)return 0;var r=n.properties.aggregate_outflows-a.min,t=a.max-a.min;return(e.max-e.min)*(r/t)+e.min},u.color=function(n){return arguments.length?(i=n,u):i},u.fill=function(n){var r=n.properties.aggregate_outflows-a.min,e=a.max-a.min;return i(r/e)},u},r}const o=Object.assign(r,{scale:e.scale});n.spatialsankey=t,Object.defineProperty(n,"__esModule",{value:!0})});