!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(n.d3=n.d3||{})}(this,function(n){"use strict";function r(){var n,r={},e={},t=[],o=[],i={},a={};return r.lmap=function(e){return arguments.length?(n=e,r):n},r.nodes=function(n){return arguments.length?(e=n,e.features&&(e=e.features),e.forEach(function(n){n.geometry.coordinates.reverse()}),r):e},r.flows=function(n){return arguments.length?(o=n,r):o},r.ranges=function(){return e=e.map(function(n){var r=t.filter(function(r){return r.target==n.id}),e=t.filter(function(r){return r.source==n.id});return n.properties.aggregate_inflows=r.reduce(function(n,r){return n+r.flow},0),n.properties.aggregate_outflows=e.reduce(function(n,r){return n+r.flow},0),n}),a.min=d3.min(t,function(n){return n.flow}),a.max=d3.max(t,function(n){return n.flow}),i.min=d3.min(e,function(n){var r=n.properties.aggregate_outflows;return 0==r?null:r}),i.max=d3.max(e,function(n){return n.properties.aggregate_outflows}),{links:a,nodes:i}},r.links=function(n){if(!arguments.length)return t;t=n,t=t.map(function(n){var r=e.filter(function(r){return r.id==n.source})[0],t=e.filter(function(r){return r.id==n.target})[0];if(!r||!t)return null;n.source_coords=r.geometry.coordinates,n.target_coords=t.geometry.coordinates;var i=o.filter(function(r){return r.id==n.id})[0];return i&&(n.flow=i.flow),n.flow=parseFloat(n.flow),n});var i=t.length;return t=t.filter(function(n){return null!=n}),i!=t.length&&console.log("Dropped "+(i-t.length)+" links that could not be matched to a node."),r.ranges(),r},r.link=function(r){var e=.4,t=.1,o={min:1,max:8},i=!1,u=!1;r&&(r.xshift&&(e=r.xshift),r.yshift&&(t=r.yshift),r.minwidth&&(o.min=r.minwidth),r.maxwidth&&(o.max=r.maxwidth),r.use_arcs&&(i=r.use_arcs),r.flip&&(u=r.flip));var f=function(r){var o=n.latLngToLayerPoint(r.source_coords),a=n.latLngToLayerPoint(r.target_coords),f=o.x-a.x,l=o.y-a.y;if(i)if(l<0||u)var c=[e*f,t*l,t*f,e*l];else var c=[t*f,e*l,e*f,t*l];else if(l<0||u)var c=[e*f,t*l,e*f,t*l];else var c=[t*f,e*l,t*f,e*l];return"M"+o.x+","+o.y+"C"+(o.x-c[0])+","+(o.y-c[1])+" "+(a.x+c[2])+","+(a.y+c[3])+" "+a.x+","+a.y},l=function(n){if(0==n.flow&&0!=a.min)return 0;var r=n.flow-a.min,e=a.max-a.min;return(o.max-o.min)*(r/e)+o.min};return f.width=function(n){return arguments.length?l=n:l},f},r.node=function(r){var e={min:10,max:20};node_color_range=["yellow","red"],r&&(r.minradius&&(e.min=r.minradius),r.maxradius&&(e.max=r.maxradius),r.mincolor&&(node_color_range[0]=r.mincolor),r.maxcolor&&(node_color_range[1]=r.maxcolor));var t=d3.scale.linear().domain([0,1]).range(node_color_range),o={};return o.cx=function(r){return cx=n.latLngToLayerPoint(r.geometry.coordinates).x,cx||null},o.cy=function(r){return cy=n.latLngToLayerPoint(r.geometry.coordinates).y,cy||null},o.r=function(n){if(0==n.properties.aggregate_outflows)return 0;var r=n.properties.aggregate_outflows-i.min,t=i.max-i.min;return(e.max-e.min)*(r/t)+e.min},o.color=function(n){return arguments.length?(t=n,o):t},o.fill=function(n){var r=n.properties.aggregate_outflows-i.min,e=i.max-i.min;return t(r/e)},o},r}n.spatialsankey=r,Object.defineProperty(n,"__esModule",{value:!0})});